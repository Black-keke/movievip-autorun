name: ðŸŽ¬ Daily MovieVIP Task (8-10ç‚¹éšæœº)

on:
  schedule:
    - cron: '0 0 * * *' # æ¯å¤©UTCæ—¶é—´00:00ï¼ˆåŒ—äº¬æ—¶é—´08:00ï¼‰è§¦å‘
  workflow_dispatch:

jobs:
  generate-schedule:
    runs-on: ubuntu-latest
    outputs:
      random_minute: ${{ steps.set-random.outputs.minute }}
    steps:
      - name: Generate random minute between 0 and 120 (8:00-10:00)
        id: set-random
        run: echo "minute=$(($RANDOM % 120))" >> $GITHUB_OUTPUT

  create-and-run:
    needs: generate-schedule
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup GitHub CLI
        run: gh auth login --with-token <<< "${{ secrets.GH_API_TOKEN }}"

      - name: Display random execution time
        run: |
          echo "ðŸŽ² ä»Šå¤©ä»»åŠ¡å°†åœ¨ 8ç‚¹${{ needs.generate-schedule.outputs.random_minute }}åˆ†æ‰§è¡Œ"
          echo "ï¼ˆ8:00 + ${{ needs.generate-schedule.outputs.random_minute }}åˆ†é’Ÿï¼‰"

      - name: Create and Run Codespace
        timeout-minutes: 10
        run: |
          # åˆ›å»º codespace ä½†ä¸ç­‰å¾…å®ƒå®Œå…¨å°±ç»ªï¼ˆå¿½ç•¥ SSH é”™è¯¯ï¼‰
          gh codespace create --repo ${{ github.repository }} --branch main --machine basicLinux32gb --idle-timeout 5m --display-name "MovieVIP Runner" -s || echo "Codespace created successfully (SSH check ignored)"
          
          # æ·»åŠ ä¸€ä¸ªå°å»¶è¿Ÿï¼Œç¡®ä¿ codespace æœ‰è¶³å¤Ÿæ—¶é—´å¯åŠ¨
          sleep 30
        env:
          GH_TOKEN: ${{ secrets.GH_API_TOKEN }}
