name: ðŸŽ¬ Daily MovieVIP Task (8-10ç‚¹éšæœº)

on:
  schedule:
    - cron: '0 0 * * *' # æ¯å¤©UTCæ—¶é—´00:00ï¼ˆåŒ—äº¬æ—¶é—´08:00ï¼‰è§¦å‘ï¼Œç”Ÿæˆéšæœºæ—¶é—´
  workflow_dispatch:     # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  generate-schedule:
    runs-on: ubuntu-latest
    outputs:
      random_minute: ${{ steps.set-random.outputs.minute }}
    steps:
      - name: Generate random minute between 0 and 120 (8:00-10:00)
        id: set-random
        run: echo "minute=$(($RANDOM % 120))" >> $GITHUB_OUTPUT

  create-and-run:
    needs: generate-schedule
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup GitHub CLI
        run: gh auth login --with-token <<< "${{ secrets.GH_API_TOKEN }}"

      - name: Display random execution time
        run: |
          hours=$(( ${{ needs.generate-schedule.outputs.random_minute }} / 60 ))
          minutes=$(( ${{ needs.generate-schedule.outputs.random_minute }} % 60 ))
          echo "ðŸŽ² ä»Šå¤©ä»»åŠ¡å°†åœ¨ 8ç‚¹${{ needs.generate-schedule.outputs.random_minute }}åˆ† (8:00 + ${{ needs.generate-schedule.outputs.random_minute }}åˆ†é’Ÿ) æ‰§è¡Œ"

      - name: Create and Run Codespace
        timeout-minutes: 10 # è®¾ç½®æ­¤æ­¥éª¤æœ€é•¿ç­‰å¾…10åˆ†é’Ÿ
        run: |
          gh codespace create --repo ${{ github.repository }} --branch main --machine basicLinux32gb --idle-timeout 5m --display-name "MovieVIP Runner" --wait-for-ready false -s
        env:
          GH_TOKEN: ${{ secrets.GH_API_TOKEN }}
